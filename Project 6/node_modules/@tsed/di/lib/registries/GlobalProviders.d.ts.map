{"version":3,"sources":["registries/GlobalProviders.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,QAAQ,EAAE,IAAI,EAAC,MAAM,YAAY,CAAC;AAC1C,OAAO,EAAC,QAAQ,EAAC,MAAM,mBAAmB,CAAC;AAC3C,OAAO,EAAC,SAAS,EAAE,gBAAgB,EAAE,aAAa,EAAE,sBAAsB,EAAC,MAAM,eAAe,CAAC;AAEjG,qBAAa,sBAAuB,SAAQ,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC;IACjF;;;OAGG;IACH,OAAO,CAAC,WAAW,CAA4C;;IAM/D;;;;;;OAMG;IACH,cAAc,CACZ,IAAI,EAAE,MAAM,EACZ,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,EAC1B,OAAO,GAAE,OAAO,CAAC,gBAAgB,CAAsB,GACtD,sBAAsB;IAmBzB;;;;OAIG;IACH,mBAAmB,CAAC,MAAM,EAAE,MAAM,GAAG,aAAa,GAAG,gBAAgB;IAsBrE;;;OAGG;IACH,gBAAgB,CAAC,IAAI,EAAE,MAAM;IAa7B;;;;OAIG;IACH,WAAW,CAAC,MAAM,EAAE,MAAM,GAAG,aAAa,GAAG,sBAAsB;CAGpE;AAED;;;GAGG;AAEH,eAAO,MAAM,eAAe,wBAA+B,CAAC","file":"GlobalProviders.d.ts","sourcesContent":["import {Registry, Type} from \"@tsed/core\";\nimport {Provider} from \"../class/Provider\";\nimport {IProvider, RegistrySettings, TokenProvider, TypedProvidersRegistry} from \"../interfaces\";\n\nexport class GlobalProviderRegistry extends Registry<Provider<any>, IProvider<any>> {\n  /**\n   * Internal Map\n   * @type {Array}\n   */\n  private _registries: Map<string, RegistrySettings> = new Map();\n\n  constructor() {\n    super(Provider);\n  }\n\n  /**\n   *\n   * @param {string} type\n   * @param {Type<Provider<any>>} model\n   * @param options\n   * @returns {Registry<Provider<any>, IProvider<any>>}\n   */\n  createRegistry(\n    type: string,\n    model: Type<Provider<any>>,\n    options: Partial<RegistrySettings> = {injectable: true}\n  ): TypedProvidersRegistry {\n    const registry = new Registry<Provider<any>, IProvider<any>>(model, {\n      onCreate: this.set.bind(this)\n    });\n\n    this._registries.set(\n      type,\n      Object.assign(\n        {\n          registry,\n          injectable: true\n        },\n        options\n      )\n    );\n\n    return registry;\n  }\n\n  /**\n   *\n   * @param {string | TokenProvider} target\n   * @returns {RegistrySettings | undefined}\n   */\n  getRegistrySettings(target: string | TokenProvider): RegistrySettings {\n    let type: string = \"provider\";\n\n    if (typeof target === \"string\") {\n      type = target;\n    } else {\n      const provider = this.get(target);\n      if (provider) {\n        type = provider.type;\n      }\n    }\n\n    if (this._registries.has(type)) {\n      return this._registries.get(type)!;\n    }\n\n    return {\n      registry: this,\n      injectable: true\n    };\n  }\n\n  /**\n   *\n   * @returns {(provider: (any | IProvider<any>), instance?: any) => void}\n   */\n  createRegisterFn(type: string) {\n    return (provider: any | IProvider<any>, instance?: any): void => {\n      if (!provider.provide) {\n        provider = {\n          provide: provider\n        };\n      }\n\n      provider = Object.assign({instance}, provider, {type});\n      this.getRegistry(type).merge(provider.provide, provider);\n    };\n  }\n\n  /**\n   *\n   * @param {string | TokenProvider} target\n   * @returns {Registry<Provider<any>, IProvider<any>>}\n   */\n  getRegistry(target: string | TokenProvider): TypedProvidersRegistry {\n    return this.getRegistrySettings(target).registry;\n  }\n}\n\n/**\n *\n * @type {GlobalProviders}\n */\n// tslint:disable-next-line: variable-name\nexport const GlobalProviders = new GlobalProviderRegistry();\n"],"sourceRoot":"../../src"}