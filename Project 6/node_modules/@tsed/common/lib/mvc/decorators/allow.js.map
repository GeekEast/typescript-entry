{"version":3,"sources":["mvc/decorators/allow.ts"],"names":[],"mappings":";;AACA,0EAAqE;AAErE,mFAA8E;AAC9E,0FAAqF;AAErF;;;;;;;;;;;;;;;;;;;;;;;;GAwBG;AACH,SAAgB,KAAK,CAAC,GAAG,qBAA4B;IACnD,MAAM,iBAAiB,GAAG,+CAAsB,CAAC,CAAC,MAAkB,EAAE,EAAE;QACtE,IAAI,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE;YAC3B,IAAI,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE;gBACtB,MAAM,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,EAAE,EAAC,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,IAAI,EAAC,CAAC,CAAC;gBACnE,OAAO,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC;aAC3B;iBAAM;gBACL,MAAM,CAAC,MAAM,CAAC,IAAI,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,MAAM,CAAQ,CAAC,CAAC;aAC9D;SACF;IACH,CAAC,CAAC,CAAC;IAEH,OAAO,CAAC,MAAiB,EAAE,WAAmB,EAAE,cAAuB,EAAQ,EAAE;QAC/E,IAAI,OAAO,cAAc,KAAK,QAAQ,EAAE;YACtC,MAAM,aAAa,GAAG,6BAAa,CAAC,GAAG,CAAC,MAAM,EAAE,WAAW,EAAE,cAAc,CAAC,CAAC;YAC7E,aAAa,CAAC,qBAAqB,GAAG,qBAAqB,CAAC;YAE5D,6BAAa,CAAC,GAAG,CAAC,MAAM,EAAE,WAAW,EAAE,cAAc,EAAE,aAAa,CAAC,CAAC;SACvE;aAAM;YACL,MAAM,gBAAgB,GAAG,mCAAgB,CAAC,GAAG,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;YACnE,gBAAgB,CAAC,qBAAqB,GAAG,qBAAqB,CAAC;YAE/D,mCAAgB,CAAC,GAAG,CAAC,MAAM,EAAE,WAAW,EAAE,gBAAgB,CAAC,CAAC;YAE5D,IAAI,qBAAqB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,CAAC,EAAE;gBAC9C,iBAAiB,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;aACxC;SACF;IACH,CAAC,CAAC;AACJ,CAAC;AA7BD,sBA6BC","file":"allow.js","sourcesContent":["import {Type} from \"@tsed/core\";\nimport {ParamRegistry} from \"../../filters/registries/ParamRegistry\";\nimport {JsonSchema} from \"../../jsonschema/class/JsonSchema\";\nimport {PropertyRegistry} from \"../../jsonschema/registries/PropertyRegistry\";\nimport {decoratorSchemaFactory} from \"../../jsonschema/utils/decoratorSchemaFactory\";\n\n/**\n * Add allowed values when the property or parameters is required.\n *\n * #### Example on parameter:\n *\n * ```typescript\n * @Post(\"/\")\n * async method(@Required() @Allow(\"\") @BodyParams(\"field\") field: string) {}\n * ```\n * > Required will throw a BadRequest when the given value is `null` or `undefined` but not for an empty string.\n *\n * #### Example on model:\n *\n * ```typescript\n * class Model {\n *   @JsonProperty()\n *   @Required()\n *   @Allow(\"\")\n *   field: string;\n * }\n * ```\n *\n * @returns {Function}\n * @decorator\n */\nexport function Allow(...allowedRequiredValues: any[]): any {\n  const allowNullInSchema = decoratorSchemaFactory((schema: JsonSchema) => {\n    if (schema && schema.mapper) {\n      if (schema.mapper.$ref) {\n        schema.mapper.oneOf = [{type: \"null\"}, {$ref: schema.mapper.$ref}];\n        delete schema.mapper.$ref;\n      } else {\n        schema.mapper.type = [].concat(schema.type, [\"null\"] as any);\n      }\n    }\n  });\n\n  return (target: Type<any>, propertyKey: string, parameterIndex?: number): void => {\n    if (typeof parameterIndex === \"number\") {\n      const paramMetadata = ParamRegistry.get(target, propertyKey, parameterIndex);\n      paramMetadata.allowedRequiredValues = allowedRequiredValues;\n\n      ParamRegistry.set(target, propertyKey, parameterIndex, paramMetadata);\n    } else {\n      const propertyMetadata = PropertyRegistry.get(target, propertyKey);\n      propertyMetadata.allowedRequiredValues = allowedRequiredValues;\n\n      PropertyRegistry.set(target, propertyKey, propertyMetadata);\n\n      if (allowedRequiredValues.some(e => e == null)) {\n        allowNullInSchema(target, propertyKey);\n      }\n    }\n  };\n}\n"],"sourceRoot":"../../../src"}