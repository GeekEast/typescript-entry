{"version":3,"sources":["mvc/class/ControllerProvider.ts"],"names":[],"mappings":"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","file":"ControllerProvider.js","sourcesContent":["import {Enumerable, NotEnumerable, Type} from \"@tsed/core\";\nimport {Provider, ProviderType} from \"@tsed/di\";\nimport * as Express from \"express\";\nimport {IRouterSettings} from \"../../config/interfaces/IServerSettings\";\n\nimport {IControllerMiddlewares, IControllerProvider} from \"../interfaces\";\nimport {EndpointRegistry} from \"../registries/EndpointRegistry\";\nimport {EndpointMetadata} from \"./EndpointMetadata\";\n\nexport interface IChildrenController extends Type<any> {\n  $parentCtrl?: ControllerProvider;\n}\n\nexport class ControllerProvider extends Provider<any> implements IControllerProvider {\n  @NotEnumerable()\n  public router: Express.Router & {[index: string]: any};\n  /**\n   * The path for the controller\n   */\n  @Enumerable()\n  public path: string;\n  /**\n   * Controllers that depend to this controller.\n   * @type {Array}\n   * @private\n   */\n  @NotEnumerable()\n  private _children: IChildrenController[] = [];\n\n  constructor(provide: any) {\n    super(provide);\n    this.type = ProviderType.CONTROLLER;\n  }\n\n  /**\n   *\n   * @returns {Endpoint[]}\n   */\n  get endpoints(): EndpointMetadata[] {\n    return EndpointRegistry.getEndpoints(this.provide);\n  }\n\n  /**\n   *\n   * @returns {Type<any>[]}\n   */\n  get children(): IChildrenController[] {\n    return this._children;\n  }\n\n  /**\n   *\n   * @param children\n   */\n  @Enumerable()\n  set children(children: IChildrenController[]) {\n    this._children = children;\n    this._children.forEach(d => (d.$parentCtrl = this));\n  }\n\n  /**\n   *\n   * @returns {IRouterSettings}\n   */\n  get routerOptions(): IRouterSettings {\n    return this.store.get(\"routerOptions\");\n  }\n\n  /**\n   *\n   * @param value\n   */\n  set routerOptions(value: IRouterSettings) {\n    this.store.set(\"routerOptions\", value);\n  }\n\n  /**\n   *\n   * @returns {ControllerProvider}\n   */\n  get parent() {\n    return this.provide.$parentCtrl;\n  }\n\n  /**\n   *\n   * @returns {any[]}\n   */\n  get middlewares(): IControllerMiddlewares {\n    return Object.assign(\n      {\n        use: [],\n        useAfter: [],\n        useBefore: []\n      },\n      this.store.get(\"middlewares\") || {}\n    );\n  }\n\n  /**\n   *\n   * @param middlewares\n   */\n  set middlewares(middlewares: IControllerMiddlewares) {\n    const mdlwrs = this.middlewares;\n    const concat = (key: string, a: any, b: any) => (a[key] = a[key].concat(b[key]));\n\n    Object.keys(middlewares).forEach((key: string) => {\n      concat(key, mdlwrs, middlewares);\n    });\n    this.store.set(\"middlewares\", mdlwrs);\n  }\n\n  /**\n   * Resolve final endpoint url.\n   */\n  public getEndpointUrl(routerPath?: string): string {\n    return (routerPath === this.path ? this.path : (routerPath || \"\") + this.path).replace(/\\/\\//gi, \"/\");\n  }\n\n  /**\n   *\n   */\n  public hasEndpointUrl() {\n    return !!this.path;\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  public hasChildren(): boolean {\n    return !!this.children.length;\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   */\n  public hasParent(): boolean {\n    return !!this.provide.$parentCtrl;\n  }\n}\n"],"sourceRoot":"../../../src"}