{"version":3,"sources":["class/Registry.ts"],"names":[],"mappings":";;AACA,oCAAoD;AAmBpD;;GAEG;AACH,MAAa,QAAe,SAAQ,GAAmB;IACrD;;;;OAIG;IACH,YAAoB,MAAe,EAAU,UAA2B,EAAE;QACxE,KAAK,EAAE,CAAC;QADU,WAAM,GAAN,MAAM,CAAS;QAAU,YAAO,GAAP,OAAO,CAAsB;QAExE,IAAI,CAAC,MAAM,GAAG,gBAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACtC,CAAC;IAED;;;;OAIG;IACH,GAAG,CAAC,GAAgB;QAClB,OAAO,KAAK,CAAC,GAAG,CAAC,wBAAgB,CAAC,GAAG,CAAC,CAAC,CAAC;IAC1C,CAAC;IAED;;;OAGG;IACH,iBAAiB,CAAC,GAAgB;QAChC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;YAClB,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YAClC,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;YACpB,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE;gBACzC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;aAClC;SACF;QAED,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAE,CAAC;IACxB,CAAC;IAED;;;;OAIG;IACH,GAAG,CAAC,GAAgB;QAClB,OAAO,KAAK,CAAC,GAAG,CAAC,wBAAgB,CAAC,GAAG,CAAC,CAAC,CAAC;IAC1C,CAAC;IAED;;;;;OAKG;IACH,GAAG,CAAC,GAAgB,EAAE,QAAW;QAC/B,KAAK,CAAC,GAAG,CAAC,wBAAgB,CAAC,GAAG,CAAC,EAAE,QAAQ,CAAC,CAAC;QAE3C,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,MAAmB,EAAE,OAAmB;QAC5C,MAAM,IAAI,GAA6B,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;QAEtE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;YACjC,IAAI,CAAC,GAAG,CAAC,GAAI,OAAe,CAAC,GAAG,CAAC,CAAC;QACpC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IACzB,CAAC;IAED;;;;OAIG;IACH,MAAM,CAAC,GAAgB;QACrB,OAAO,KAAK,CAAC,MAAM,CAAC,wBAAgB,CAAC,GAAG,CAAC,CAAC,CAAC;IAC7C,CAAC;CACF;AAhFD,4BAgFC","file":"Registry.js","sourcesContent":["import {Type} from \"../interfaces\";\nimport {getClass, getClassOrSymbol} from \"../utils\";\n\nexport interface RegistryHook<T> {\n  /**\n   *\n   * @param {RegistryKey} key\n   * @param {T} item\n   */\n  onCreate?(key: RegistryKey, item: T): void;\n\n  /**\n   *\n   * @param {RegistryKey} key\n   */\n  // onDelete?(key: RegistryKey): void;\n}\n\nexport type RegistryKey = string | symbol | Type<any> | Function | any;\n\n/**\n * @private\n */\nexport class Registry<T, O> extends Map<RegistryKey, T> {\n  /**\n   *\n   * @param {Type<T>} _class\n   * @param {RegistryHook<T>} options\n   */\n  constructor(private _class: Type<T>, private options: RegistryHook<T> = {}) {\n    super();\n    this._class = getClass(this._class);\n  }\n\n  /**\n   * The get() method returns a specified element from a Map object.\n   * @param key Required. The key of the element to return from the Map object.\n   * @returns {T} Returns the element associated with the specified key or undefined if the key can't be found in the Map object.\n   */\n  get(key: RegistryKey): T | undefined {\n    return super.get(getClassOrSymbol(key));\n  }\n\n  /**\n   *\n   * @param key\n   */\n  createIfNotExists(key: RegistryKey): T {\n    if (!this.has(key)) {\n      const item = new this._class(key);\n      this.set(key, item);\n      if (this.options && this.options.onCreate) {\n        this.options.onCreate(key, item);\n      }\n    }\n\n    return this.get(key)!;\n  }\n\n  /**\n   * The has() method returns a boolean indicating whether an element with the specified key exists or not.\n   * @param key\n   * @returns {boolean}\n   */\n  has(key: RegistryKey): boolean {\n    return super.has(getClassOrSymbol(key));\n  }\n\n  /**\n   * The set() method adds or updates an element with a specified key and value to a Map object.\n   * @param key Required. The key of the element to add to the Map object.\n   * @param metadata Required. The value of the element to add to the Map object.\n   * @returns {Registry}\n   */\n  set(key: RegistryKey, metadata: T): this {\n    super.set(getClassOrSymbol(key), metadata);\n\n    return this;\n  }\n\n  /**\n   *\n   * @param target\n   * @param options\n   */\n  merge(target: RegistryKey, options: Partial<O>): void {\n    const meta: T & {[key: string]: any} = this.createIfNotExists(target);\n\n    Object.keys(options).forEach(key => {\n      meta[key] = (options as any)[key];\n    });\n\n    this.set(target, meta);\n  }\n\n  /**\n   * The delete() method removes the specified element from a Map object.\n   * @param key Required. The key of the element to remove from the Map object.\n   * @returns {boolean} Returns true if an element in the Map object existed and has been removed, or false if the element does not exist.\n   */\n  delete(key: RegistryKey): boolean {\n    return super.delete(getClassOrSymbol(key));\n  }\n}\n"],"sourceRoot":"../../src"}